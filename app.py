import streamlit as st
import requests
import pandas as pd
from geopy.distance import geodesic
from geopy.geocoders import Nominatim

OSRM_SERVER = "https://router.project-osrm.org"

tankstations = [
    ("ADRIANO OLIVETTI SNC 13048", 45.38002020650739, 8.14634168147584),
    ("LUIGI GHERZI 15 28100", 45.454214522946366, 8.648874406509199),
    ("MEZZACAMPAGNA SNC 37135", 45.38885497663997, 10.993260597366502),
    ("Via Gramsci 45 15061", 44.69849229353388, 8.884370036245732),
    ("Korendreef  31", 51.750893, 4.16553),
    ("Osterstra√üe 90", 52.8505833333333, 8.05091666666667),
    ("An der alten Bundesstra√üe 210", 53.56057, 7.915976),
    ("An der B 167 4 (Finowfurt)", 52.84995142, 13.6860187738),
    ("Bischheimer Stra√üe 9", 49.66834, 8.019837),
    ("Bremer Stra√üe 72 (Ostenburg)", 53.12928341, 8.22720408),
    ("Elmshorner Stra√üe 36", 53.905796, 9.507996),
    ("Erftstra√üe 127 (Sindorf)", 50.9115278, 6.6834722),
    ("Esenser Stra√üe 109", 53.48224, 7.49042),
    ("Friedenstra√üe 36", 52.33592, 14.07347),
    ("Hannoversche Heerstra√üe 44", 52.6091111111111, 10.07575),
    ("Jeverstra√üe 9", 53.57615, 7.792493),
    ("Laatzener Stra√üe  10 (Mittelfeld Messe)", 52.3231389, 9.813944),
    ("Neuenkamper Stra√üe 2-4", 51.177067, 7.211746),
    ("Oberrege 6", 53.235475, 8.455755),
    ("Oldenburger Stra√üe 290a", 53.056872, 8.199678),
    ("Prinzessinweg 2 (Haarentor)", 53.1435, 8.19194),
    ("Sch√ºtzenstra√üe 11", 52.395114, 13.533889),
    ("Spenglerstra√üe 2, Bernauer Stra√üe, B 2 (Lindenberg)", 52.6081944444444, 13.52875),
    ("Werler Stra√üe 30", 52.084475, 8.736217),
    ("Winsener Stra√üe 25 (Maschen)", 53.39059096, 10.04460454),
    ("Frankfurter Chaussee 68 (Fredersdorf)", 52.499652, 13.743842),
    ("Rudolf-Diesel-Stra√üe 2 (J√ºbberde Remels Apen)", 53.26297, 7.756261),
    ("A. Plesmanlaan 1", 53.176219, 6.733337),
    ("Bornholmstraat 99", 53.2043178635, 6.612641631),
    ("B√∂seler Stra√üe 6", 52.96187, 8.026265),
    ("nan", 51.77875, 7.16205555555556),
    ("nan", 53.1523333333333, 7.71202777777778),
    ("Beusichemseweg 58", 52.004804, 5.21631),
    ("Couwenhoekseweg 6", 51.937013, 4.592922),
    ("Emma Goldmanweg 4 (Katsbogten)", 51.537532, 5.040958),
    ("Groningerweg 58", 53.167164, 6.496736),
    ("Henri Blomjousstraat 1", 51.584174, 5.057983),
    ("Im Doorgrund 2", 53.17015, 7.998636),
    ("Kruisweg 471 (Schiphol)", 52.286843, 4.727935),
    ("Skoon 2", 52.432218, 4.875834),
    ("Stedinger Stra√üe 6 (Bookholzberg)", 53.0891944444444, 8.52883333333333),
    ("Wasaweg  20", 53.215244, 6.613511),
    ("nan", 49.01990844, 10.95113754),
    ("Hauptstra√üe 138", 53.41759, 7.739631),
    ("Bregenzer Stra√üe 43", 47.5527777777778, 9.70163888888889),
    ("Blexersander Stra√üe 2", 53.50733, 8.4948055),
    ("Daimlerstra√üe 32", 48.603166, 8.870917),
    ("Oldenburger Stra√üe 69", 52.737108, 8.285123),
    ("Siedlungsweg 2", 51.110276, 10.929985),
    ("Leher Stra√üe 2a (Spaden)", 53.571171, 8.622775),
    ("Bedrijfsweg 2", 52.09607, 4.945655),
    ("Binckhorstlaan 100", 52.07174, 4.335824),
    ("Cornelis Douwesweg 15", 52.415359, 4.874565),
    ("Middelweg 3", 51.844831, 4.519428),
    ("Middenweg 100", 50.985302, 5.843929),
    ("A4", 52.261493, 4.68724),
    ("F√ºrstenwalder Stra√üe 10c", 52.182064, 14.242636),
    ("Langenfelder Stra√üe 105", 51.066226, 6.924465),
    ("Bahnhofstra√üe 40", 53.0913055555556, 7.39080555555556),
    ("Bremer Stra√üe 55", 53.112635, 9.22681),
    ("Giflitzer Stra√üe 12", 51.1326111111111, 9.12341666666667),
    ("Ostendorfer Stra√üe 1", 53.219486, 8.935207),
    ("Industriestraat 1", 52.011277, 4.693377),
    ("Maaswijkweg 5", 51.84198, 4.347907),
    ("Vormerij 12", 52.28670629, 6.74478852473),
    ("Burgemeester Grollemanweg 8", 52.95947712, 6.5486321837),
    ("Changing Lane 10", 52.270314, 4.692568),
    ("Rijksstraatweg 124", 51.751246, 4.63926),
    ("Noorddijk 7", 51.466612, 5.688338),
    ("Merziger Stra√üe 148", 49.3587777777778, 6.71811111111111),
    ("nan", 51.144573, 11.834173),
    ("nan", 52.70465, 13.44013),
    ("Ammerlandallee 18-20", 53.251945, 7.932015),
    ("Berliner Stra√üe 6", 51.29363, 7.289787),
    ("Binderslebener Landstra√üe 100", 50.97213, 10.97484),
    ("Erdinger Stra√üe 145", 48.3841388888889, 11.7640833333333),
    ("Europa-Allee 4", 52.542936, 5.919186),
    ("Fahrenheitstraat 2", 53.182238, 5.46097),
    ("Gro√üe Rurstra√üe 100", 50.920081, 6.353367019),
    ("Gr√ºner Hof 5", 53.02425, 7.86286111111111),
    ("Hamburger Stra√üe 211", 53.74818, 9.694082),
    ("Heinsbergerweg 3a", 51.155393, 6.006385),
    ("Lathener Stra√üe 1 - 3", 52.705282, 7.296353),
    ("Mainzer Stra√üe 84", 49.642790997, 8.36337221285),
    ("Martin-Luther-Stra√üe 18", 51.398748, 7.178095),
    ("Oldenburger Damm 12", 53.4845277777778, 8.02744444444444),
    ("Oldenburger Stra√üe 14", 53.391638, 8.136491),
    ("Oldenburger Stra√üe 141", 53.23668608, 8.20006013),
    ("Oranienbaumer Chaussee 40 (Mildensee)", 51.82499, 12.30073),
    ("Podbielskistra√üe 216 (List)", 52.3995, 9.78091666666667),
    ("Schiffm√ºhler Stra√üe 2", 52.79053, 14.04639),
    ("Schwieberdinger Stra√üe 133", 48.8898, 9.160853),
    ("Uerdinger Stra√üe 8", 51.3034, 6.671233),
    ("Vahrenwalder Stra√üe 138 (Vahrenwald)", 52.397528, 9.736694),
    ("Wachbacher Stra√üe 100", 49.4763888888889, 9.77155555555556),
    ("Weimarische Stra√üe 36", 50.97375, 11.0545833333333),
    ("Werner-Kammann-Stra√üe 3-7", 53.86635, 8.696526),
    ("nan", 50.114512, 8.61725),
    ("Am Zainer Berg 2 (Rh√ºden)", 51.9472222222222, 10.1393611111111),
    ("nan", 52.664354, 8.256793),
    ("Benjamin Franklinstraat 2", 52.35916, 6.512449),
    ("Ossebroeken 8", 52.859074945, 6.495129228),
    ("Stephensonstraat 63", 52.728889, 6.521828),
    ("Stettinweg 22", 53.220582, 6.602814),
    ("Wethouder Kuijersstraat 2", 52.631537, 6.212359),
    ("Morseweg 1c", 53.187406, 5.755853),
    ("Kemnather Stra√üe 78", 50.033676, 11.989554),
    ("Ziegelh√ºtter Weg 14-16", 51.283187, 8.862887),
    ("Biltseweg 2", 52.173667, 5.24636),
    ("Bremer Stra√üe 69", 52.4390833333333, 9.58880555555556),
    ("Hans-Mess-Stra√üe 2", 50.2241001665, 8.5805411038),
    ("Industriestra√üe 29", 50.54927, 11.789001),
    ("Steinbr√ºchenstra√üe 1", 50.96672, 11.25742),
    ("B√ºnder Stra√üe 184 (Lippinghausen)", 52.1491387799, 8.65002118326),
    ("nan", 53.06023636928, 9.16493268831),
    ("Posthalterweg 10 (Wechloy)", 53.15943, 8.172347),
    ("Gottlieb-Daimler-Stra√üe 2c (Harber)", 52.99676157, 9.92126584),
    ("Otto-Hahn-Stra√üe 5", 52.82889, 8.11742),
    ("Hagener Stra√üe 110-114", 51.3251138375, 7.3529331245),
    ("Galjoenweg 17", 50.87641, 5.705766),
    ("Davenstedter Stra√üe 128a (Lindener Hafen)", 52.36544, 9.6900278),
    ("De Flinesstraat 9 (Duivendrecht)", 52.324954, 4.925004),
    ("Industriestra√üe 10", 52.1914722222222, 8.35427777777778),
    ("nan", 53.220329, 7.474366),
    ("nan", 49.37658, 10.1993),
    ("nan", 49.975596, 8.024672),
    ("nan", 50.094005576, 9.0495923987),
    ("nan", 51.8109444444444, 10.9385833333333),
    ("nan", 52.257729, 11.844004),
    ("A.J. Romijnweg  10", 53.13488, 7.05049),
    ("Aleh√∂gsv√§gen 2", 57.383421, 14.658687),
    ("Antenngatan 2 (Marconimotet)", 57.65942, 11.93295),
    ("Argongatan 30 (√Öbro Industriomr√•de)", 57.64175, 12.00772),
    ("Atoomweg 40", 52.10532, 5.06719),
    ("Australi√´havenweg 21", 52.39996, 4.795264),
    ("Axel Odhners Gata 60 (H√∂gsbo)", 57.65061, 11.95224),
    ("Barrier Stra√üe 33", 52.93144, 8.82531),
    ("Bergerstra√üe 97", 52.835972, 13.811128),
    ("Beurtvaart 3", 53.320804, 6.019134),
    ("Bock√§ngsgatan 3", 57.650627, 14.738195),
    ("Borgens gata 1", 57.930801, 12.560001),
    ("Brodalsv√§gen 6", 57.742783, 12.127561),
    ("Brof√§stet √ñland 3", 56.665372, 16.490252524),
    ("Brog√•rdsgatan 22", 57.413693, 15.083613),
    ("Bultgatan 41 (Rollsbo industriomr√•de)", 57.88082, 11.9439),
    ("De Stuwdam 5", 52.168042, 5.432304),
    ("Deltav√§gen 13", 57.72848, 11.95476),
    ("Dordrechtweg 11", 52.248439, 6.181199),
    ("Drottningholmsv√§gen 490 (Bromma)", 59.337762, 17.934343),
    ("Florynwei  5", 53.205037, 5.984536),
    ("F√∂rr√•dsv√§gen 1", 58.286241, 11.461953),
    ("Generatorstraat 18", 52.394434, 4.851491),
    ("Gjutj√§rnsgatan 1 (Ring√∂n)", 57.72009, 11.96297),
    ("G√∂teborgsv√§gen 2a", 57.7639, 12.2594),
    ("Hammarsmedsgatan 27", 58.6784104, 13.820191),
    ("Hangarv√§gen (H√§rryda)", 57.673074, 12.300632),
    ("Hantverksgatan 34 (Inlag)", 57.47849019699, 12.08231532),
    ("Hjortsh√∂gsv√§gen 7", 56.06527923, 12.7667509757),
    ("Hoendiep 270", 53.214386, 6.492455),
    ("Importgatan 4 (Hisings Backa)", 57.74757535, 11.9924708334),
    ("Industriewei 25", 52.966524, 5.815859),
    ("Johannesbergsv√§gen 1", 58.35541, 12.31506),
    ("Kraftgatan 11", 57.747662, 14.163162),
    ("Kungsparksv√§gen 1", 57.50996, 12.06621),
    ("Monteringsv√§gen 2 (Volvo S√∂rred)", 57.7133, 11.84243),
    ("Nudepark 200", 51.960387, 5.64495),
    ("Oljev√§gen 1", 58.39289, 13.87718),
    ("Overijsselsestraatweg 1a", 53.1073, 5.783931),
    ("Petter J√∂nssons V√§g 4", 57.676224, 14.694648),
    ("Pluto 3", 52.97605227, 5.937511449),
    ("Rams√•sa 908", 55.5600923446, 13.912333685),
    ("Regementsgatan  22", 57.715885, 12.917635),
    ("Ribbingsbergsgatan 5", 55.545217, 14.335263),
    ("Robert-Koch-Stra√üe 4", 52.8530625009, 9.691328306979),
    ("Sankt Sigfridsgatan 91 (Kalleb√§ck)", 57.68968, 12.00471),
    ("Sikkel 22", 53.321455, 6.882426),
    ("Sl√§ngom", 58.35423, 11.91448),
    ("Spadegatan 22 (Angered)", 57.788889, 12.0454),
    ("Stettiner Stra√üe 25", 50.4353207328, 7.49241615241),
    ("Susvindsv√§gen 21", 57.1224, 12.28136),
    ("Sydhamnsgatan 12", 56.02898, 12.70587),
    ("Tallskogsv√§gen", 58.4925833, 13.13884665),
    ("Tradenv√§gen 6 (H√•by g√•rd)", 58.488548, 11.629203),
    ("Vallenv√§gen 5 (Stora H√∂ga)", 58.023234, 11.840188),
    ("V√§nersborgsv√§gen - Wallentinsv√§gen", 58.040512, 12.801716),
    ("Vasav√§gen 1", 57.78512, 14.23078),
    ("Veldkampsweg 26", 52.3522734, 6.656573),
    ("Vilangatan", 58.39008, 13.45906),
    ("Warodells v√§g 3", 58.150745, 13.55735775),
    ("Westfalenstra√üe  10", 51.32998815, 6.9783199233),
    ("Alte Heerstrasse 1 (Einum)", 52.161625, 10.007915),
    ("D√ºsseldorfer Landstra√üe 424 (Huckingen)", 51.35322, 6.743813),
    ("Grevesm√ºhlener Stra√üe  6", 53.829994, 11.2105979),
    ("Harburger Stra√üe 18", 53.593769, 9.477032),
    ("Lornsenstra√üe 142", 53.610576, 9.840102),
    ("Mielestra√üe 20", 52.38042, 10.006417),
    ("Rolfinckstra√üe 48 (Wellingsb√ºttel)", 53.63925, 10.0894444444444),
    ("Segeberger Chaussee 345", 53.701913, 10.057361),
    ("Viktoriastra√üe 22 - 24", 52.288848, 8.937483),
    ("Wanderslebener Stra√üe 24 (M√ºhlberg)", 50.873632, 10.830234),
    ("Nobelstraat 6", 52.363734, 5.652068),
    ("Nadorster Stra√üe 253 (Nadorst)", 53.16482529, 8.22523532658),
    ("nan", 50.579804, 12.713364),
    ("Raiffeisenstra√üe 18", 53.4573333333333, 7.49766666666667),
    ("nan", 48.5438055555556, 10.3675555555556),
    ("√Ñngelholmsv√§gen 38", 56.06192, 12.71004),
    ("Sk√∂rdev√§gen 2 (Lerberget)", 56.1808013916016, 12.5638999938965),
    ("Osterholzer Heerstra√üe 161 (Osterholz)", 53.0576111111111, 8.94875),
    ("Europaweg 1", 53.1672703156, 6.8662034432),
    ("Vossenkamp 8", 53.187931, 6.372576),
    ("nan", 53.31161, 7.45694),
    ("Berliner Stra√üe 1-3 (Dorum)", 53.686583, 8.5718056),
    ("Celler Stra√üe  58", 52.979862, 9.847354),
    ("Delmenhorster Stra√üe 12", 52.90561, 8.442472),
    ("Hindenburgstra√üe 1", 53.374120512, 9.008448425),
    ("Industriestra√üe 2", 53.280638, 9.495867),
    ("Raiffeisenstra√üe 10 (Bad Bederkesa)", 53.629423, 8.816431),
    ("Stader Stra√üe 40", 53.6811111111111, 9.17913888888889),
    ("Warsteiner Stra√üe 41", 51.3604722222222, 8.28661111111111),
    ("Werderstra√üe 3-4", 53.46922, 12.02325),
    ("Wildeshauser Landstra√üe 60", 53.018135, 8.569942),
    ("Henleinstra√üe 1", 53.027897, 8.801319),
    ("['s-Hertogenbosch]", 51.685994, 5.281339),
    ("Anthony Fokkerweg 8", 52.344105, 4.842047),
    ("De Striptekenaar 83", 52.406789, 5.322229),
    ("Dijkje 20", 51.77126, 4.926719),
    ("Haardijk 3", 52.57459, 6.602568),
    ("Ookmeerweg 501", 52.354618, 4.769484),
    ("Parkweg 98", 52.220703, 6.870358),
    ("Randweg 18 ( )", 52.698176, 5.747978),
    ("Rondweg 3", 52.290259, 6.768244),
    ("S√∂geler Stra√üe 9", 52.84862082, 7.66563535),
    ("Chausseestra√üe 1", 52.31578, 13.6041389),
    ("Ruhlebener Stra√üe 1a (Spandau)", 52.529141, 13.207393),
    ("Bahnhofstra√üe 2", 52.9684166666667, 7.34886111111111),
    ("Bassumer Stra√üe 83", 52.687037, 8.783719),
    ("Emder Stra√üe 33 (Georgsheil)", 53.47228, 7.31872),
    ("Gernr√∂der Chaussee 1", 51.7716388888889, 11.1404166666667),
    ("Mindener Stra√üe 2a", 52.20735, 8.801743),
    ("Monschauer Stra√üe 69", 50.7932222222222, 6.47052777777778),
    ("Sch√∂nauer Stra√üe 113 (Gro√üzschocher)", 51.3106944444444, 12.3088333333333),
    ("Venloer Stra√üe 1", 51.5201944444444, 6.31011111111111),
    ("Westersteder Stra√üe 14a (Zetel)", 53.3864321, 7.95387878),
    (" Marconistraat 17", 52.497058, 6.126811),
    ("Kieler Stra√üe 196 - 198 (Zentrum)", 54.0889444444444, 9.98669444444444),
    ("Cloppenburger Stra√üe 224 (Kreyenbr√ºck)", 53.117566, 8.214305),
    ("De Wissel 2", 53.268406, 5.659423),
    ("Dolderweg 48", 52.788152, 6.093207),
    ("Geraldadrift 2", 53.409509, 6.665944),
    ("Havenweg 23", 52.168234, 5.366542),
    ("Kissel 43", 50.890622, 5.99954),
    ("Okkenbroekstraat 19", 52.317137, 6.350114),
    ("Parkweg 85", 51.898633, 5.188285),
    ("Raalterweg 56", 52.332774, 6.205457),
    ("Sint Bonifaciuslaan 83", 51.424271, 5.506018),
    ("Stationsweg 24", 52.511044, 6.419701),
    ("Wijheseweg 45", 52.450177, 6.132063),
    ("Piet Van Donkplein 3", 52.24958383, 6.207222197),
    ("Schiedamsedijk 12", 51.908842, 4.365131),
    ("Seggelant-Zuid 1", 51.893914, 4.187602),
    ("nan", 52.497869, 9.456519),
    ("Cuxhavener Stra√üe 31", 53.806573, 8.891136),
    ("Midslanderhoofdweg 5 (Midsland)", 53.381652, 5.289162),
    ("Uterwei 20", 53.223764, 6.175033),
    ("Lozerlaan 4 (De Uithof)", 52.040941, 4.244279),
    ("Rijksstraatweg 82", 52.51364188, 4.65287894),
    ("de Bolder 71", 53.117055, 6.073447),
    ("Jupiterweg 7", 53.196304, 5.844352),
    ("Transportweg 24", 52.160984, 4.785012),
    ("Bremer Stra√üe 46", 52.8044, 8.647264),
    ("Hildesheimer Stra√üe 407 (W√ºlfel)", 52.3264166666667, 9.78166666666667),
    ("35 avenue Paul Dupleix - ZI du Prat", -2.713715, 47.653046),
    ("123 rue des entreprises", 0.314925600000037, 46.6109112),
    ("A89 Aire Du Manoire", 0.79985, 45.14967),
    ("Avenue de la condamine", 4.868409, 44.902353),
    ("42 Rue L√©o Lagrange", 2.446981, 48.892892),
    ("259 avenue des Etats Unis - Parc d'activit√©s de Fondeyre", 1.4274502, 43.6439483),
    ("Route de l'Empereur", -1.339769, 46.668995),
    ("Rue des Isles", 3.574478, 47.824894),
    ("route de Saint Nicolas du Port", 6.263784, 48.616934),
    ("Zone d'activit√© Saint-Martin", 2.396244, 50.661375),
    ("Rue de l'Argentique", 4.85698, 46.8249722),
    ("PAE du Confluent", 0.2678587, 44.2905509),
    ("5 rue de la Fosse aux Leux", 2.335121, 48.621169),
    ("6 rue Fr√©d√©ric Sauvage", 2.820585, 50.453928),
    ("5 rue Angiboust - ZI de la Fontaine Jouvence", 2.21100524067878, 48.6643734233119),
    ("Rue du Champ de l'Etang - ZA La Mongie", -1.180335, 46.782066),
    ("Rue des Vosges", 7.379537, 47.994342),
    ("5-7  avenue de la R√©sistance", 1.1438859, 42.9799648),
    ("rue de la Borne Blanche", 2.55253, 48.656941),
    ("Gravanche - Rue Roland Moreno", 3.132987, 45.802534),
    ("Chemin de Plaisir", 1.927528, 48.833778),
    ("Parc Logistique S IdF", 3.095635, 48.061546),
    ("rue du Moulin aux pr√™tres", -4.04556, 48.517937),
    ("rue S√©bastienne GUYOT", -2.78191, 48.467224),
    ("Chemin de la Val Priout", 1.592579, 43.0),
    ("Rue Joseph SEGUIN", 4.636564, 43.70936),
    ("Centre Routier - Z,A,M, La Veuve", 4.32241, 49.037203),
    ("2 rue Edm√© Mariotte", -1.716867, 48.051391),
    ("Chemin de la Noue Rousseau", 2.33185, 48.61911),
    ("rue Georges Charpak, ZA des Pierailleurses", -0.47399, 46.24608),
    ("Avenue Charles de Gaulle", 5.261503, 45.842769),
    ("28 rue du mar√©chal Leclerc", -2.8290069848299, 47.8815061165075),
    ("Rue Claude Girard", 5.893588, 47.231766),
    ("rue Millepertuis - ZI duRancy", 3.361335, 46.537413),
    ("55 Rue du March√© Gare", 7.73914, 48.59473),
    ("A5B - Aire de Galande la Mare", 2.634536, 48.610438),
    ("ZA La Vannerie", -1.753886, 46.51671),
    ("Rue du Tranchet - La Pommeraye", -0.861656, 47.344547),
    ("Saint Hilaire Petitville", -1.211038, 49.302724),
    ("1 rue du Fort - La Vigie", 7.69338984042406, 48.5211616197091),
    ("17 rue de la ferme Saint-Ladre", 2.5269, 49.094483),
    ("rue du grand Pommeraye", 2.672686, 48.874285),
    ("Avenue Clement Ader", 4.962134, 45.712783),
    ("ISOPARC - rue R√©gis Ramage", 0.679221, 47.257095),
    ("rond-point de Quistinidal, Route du Petit Guelen - 1  borne publique", -4.048515, 47.983303),
    ("RN 87 - Relais de Meylan", 5.781, 45.197),
    ("rue Octave Chanute", 2.86787, 42.73386),
    ("Rue du Bois de Tharlet", 5.256812, 46.226739),
    ("45 route principale du Port", 2.275066, 48.937447),
    ("51 chemin de la Carronnerie", 5.7602858, 45.198529),
    ("Route du Fileur", -0.369793, 44.882399),
    ("Rue de Dublin", 2.852732, 42.683005),
    ("Rue Marcelin Berthelot", 2.63371417, 48.97917745),
    ("lieu-dit La Talmousiere", -1.705715, 48.147625),
    ("12 rue des vernes", 4.09483, 45.5936),
    ("49 rue Felix Esclangon", 5.70959821343421, 45.1940234832681),
    ("ZAC de Boulouze", 5.136012, 47.269905),
    ("Av Leo Lagrange", -0.267418, 44.5392534),
    ("ZA Les Gabrielles", -1.939, 48.187959),
    ("504 Avenue Henri Ravisse", 1.9320771, 50.9420174),
    ("2√®me avenue du Port de Lille", 3.03036199973309, 50.6269445278623),
    ("142 route d'Oberhausbergen in Cronenbourg", 7.70945392549037, 48.5955772795552),
    ("Route de Nantes", -1.428884, 46.703223),
    ("Les Quemenes", 5.71419469, 49.513327),
    ("Rue des Coteaux de la Touche", 0.185041, 45.770949),
    ("ZAC La Terre aux dames", 4.728759, 46.098354),
    ("22 avenue Louis Bl√©riot", 2.41074, 48.935534),
    ("3 Rue Maurice HOLLANDE", 4.087868, 49.229147),
    ("Route du Noroit Port 5167", 0.2815027, 49.4815011),
    ("rue Georges Charpak - parc des autoroutes", 3.240637, 49.843942),
    ("Rue des Mousquetaires", -1.14358395338058, 43.8716593726957),
    ("Carrefour M√¢t de Ricca - Aire PL 2XL", 4.81405, 43.420607),
    ("D307", 4.87145, 45.62105),
    ("RD286 Le Clos des Daumiers", -1.534741, 48.109604),
    ("rue du Rempart", 2.544817, 48.837271),
    ("65 Rue du Baron Le Roy", 2.390219, 48.833122),
    ("Rue Santoyon", 5.106476, 45.662374),
    ("72 rue du B√™le", -1.508902, 47.264551),
    ("40-42 rue Antoine Primat", 4.89664748311042, 45.7581609441924),
    ("nan", 2.305566, 50.735984),
    ("Route des Planches - Sortie 53 autoroute A16", 2.217101, 50.982921),
    ("Rue Euclide - zone Eurocentre", 1.405987, 43.78112),
    ("13 rue des Fr√®res Lumi√®res", 2.627272, 48.980219),
    ("√âchangeur 22 - Centre Routier", -0.31, 46.3483),
    ("Lieu dit "Esseaune"", 2.607854, 48.614273),
    ("Rue Andr√© Amp√®re", 6.173779, 48.742454),
    ("rue Elisabeth Boselli", 2.64731, 48.99103),
    ("Chemin de la Mi-voie", 1.11358900000004, 49.402611),
    ("178 rue du Poirier", -0.460933, 49.195748),
    ("Rue du Ch√¢teau - ZA M√¢con Nord", 4.84404, 46.364961),
    ("Avenue de la Repentie", -1.208942, 46.171285),
    ("boulevard de la Romanerie", -0.500917, 47.482655),
    ("ZI du Salaison", 3.949191, 43.651023),
    ("Le Puits Jacob", -1.848461, 46.851616),
    ("Lieu dit Betaigne", 6.578834, 48.540564),
    ("9 avenue de Northampton", 0.37914, 46.58145),
    ("Av Jean Jacques Segard", 3.20469, 50.20056),
    ("Croix-Sud, Rue Joseph Cugno", 2.981971, 43.152307),
    ("Boulevard G√©n√©ral Leclerc", 1.976197, 43.763295),
    ("ZA de Pierailleuses rue georges Charpak", -0.47401, 46.24621),
    ("Rue de la Charmotte", 6.818224, 47.481841),
    ("ZAC les Cormiers - Rue des Cormiers", -1.78488, 48.088143),
    ("Rue Alfred Nobel", 0.746591, 44.395917),
    ("Lieu-dit KERRIO", -2.91374, 48.094461),
    ("SERNAM RUE GEORGES POLITZER", 1.9873, 48.7671),
    ("rue de la la√Øta", -1.9256, 47.377072),
    ("nan", 5.048606, 43.64009),
    ("Clesud - Avenue Isabelle Autissier", 5.00869, 43.610831),
    ("Lieu-Dit Poitou", -0.930708, 46.990741),
    ("ZI de Chantepie", -1.6255, 48.0991),
    ("4316 route de Marseille", 4.89014, 43.9061),
    ("Parc d'activit√© du Cormier", -0.915251, 47.031949),
    ("Boulevard p√©riph√©rique int√©rieur", 2.3734753159, 48.900249771),
    ("54 avenue L√©nine", 2.359673, 48.945542),
    ("Rue des Evens", -2.17633, 47.300771),
    ("La Morandais", -1.816211, 48.302029),
    ("rue Paul Gu√©ry", 3.415378, 43.446125),
    ("L'Aubini√®re", -1.18996, 47.40402),
    ("Rue des alli√©s", 5.717021, 45.173658),
    ("la Grande route de Douai", 3.037098, 50.342936),
    ("20 rue du tumulus, ZA  Motte Justices", -0.196426, 46.998152),
    ("10 rue du Doubs", 7.73448631167411, 48.5605421730605),
    ("Chemin des Batt√©es", 3.990215, 47.50782),
    ("Rue Roland Mor√©no", -0.696674, 47.467976),
    ("Rond-Point du Carrousel", -0.094036, 47.265939),
    ("174 boulevard de l'Amiral Mouch", 0.149616, 49.487559),
    ("687 avenue du 46 Royal Marine", 0.360139, 49.341889),
    ("ZA de Bel Air, route de Corseul", -2.094998, 48.450336),
    ("Route d'H√©rin", 3.447601, 50.331481),
    ("365 avenue des Jourdies", 6.37730196118354, 46.0755044167779),
    ("Avenue des trois Cardinaux - sortie 4 autoroute A630", -0.557063, 44.888117),
    ("759 avenue des Fr√®res Lumi√®res", 5.385266, 43.422344),
    ("ZAC du Moutet - Rue Joseph Aristid Auxenfans", 2.350764, 47.044559),
    ("458 rue Jean Bertin", 1.8548556, 47.9516276),
    ("Chemin du Petit Gandaillat", 3.151509, 45.762194),
    ("2 chemin de Saint L√©onard", 4.096035, 49.224835),
    ("14 rue Robert Nau", 1.33242, 47.612811),
    ("Zone de la Brosse - Boulevard L√©onard de Vinci", -1.55216, 47.158868),
    ("10 rue d'Estaub√©", 0.024978, 43.220242),
    ("Route du Fief Cordelier", 2.4955004453659, 48.774778553698),
    ("7 ter route Principale du Port", 2.29710146784782, 48.940748085731),
    ("1 rue des lances", 2.389212, 48.750342),
    ("14 rue de Breil", -1.625106, 48.095431),
    ("200 rue du Pic au Vent", 3.107529, 50.581666),
    ("ZAC du Val Br√©on", 2.832973, 48.726583),
    ("Rue du Jour", 2.364583, 48.758806),
    ("Rue Gatel", 0.095415, 48.44947),
    ("Rue Louis Bl√©riot ZI Jonqui√®re", 6.2064409, 49.2127499),
    ("rue du Bois de l'Ecu", 2.465229, 48.567426),
    ("Chemin de Tronquieres", 2.423188, 44.900379),
    ("Rue Nic√©phore Ni√©pce", -0.30314, 49.15592),
    ("EcoParc Rh√©nan 395, RD37", 7.762392, 48.663533),
    ("Rue du Bas Martineau", 2.41925, 48.9293),
    ("Chemin Neuf - ZAC Bi√®vre Dauphin√©", 5.481912, 45.379287),
    ("597 Avenue Saint Maurice", 5.818121, 43.801182),
    ("ZA de la Coudri√®re", 0.727, 47.4513),
    ("Espace Industriel les Muriers", 4.004733, 46.480896),
    ("route de Plouvorn", -3.85345525536253, 48.575646),
    ("rue jean Baptiste MARTENOT", -3.34437, 47.784409),
    ("rue du Pr√©sident Lecuyer", 3.552717, 50.387872),
    ("1 rue Kl√©ber", 2.188926, 48.900841),
    ("Rue de Rheinfeld - Centre routier", 7.783636, 48.524544),
    ("rue de la Monairie - ZI de Bellitourne", -0.684474, 47.838185),
    ("5 rue du Bois Quatorze", 2.257435, 49.934494),
    ("Les Quatre chemins, Rue Ren√© Couzinet", -0.811068, 46.444713),
    ("Boulevard p√©riph√©rique exterieur", 2.3748087885, 48.900814679),
    ("impasse RAMOUNDET", 1.257975, 43.344385),
    ("D755", -1.044082, 46.902608),
    ("rue de la grande rivi√®re", -1.976111, 48.6372222),
    ("Parking la Jangada", 2.378544, 49.868638),
    ("Z.A. les Mottais", -1.610851, 48.060619),
    ("Port Edouard Herriot - 76 avenue Tony Garnier", 4.838482, 45.726003),
    ("Avenue de la Saladelle", 3.978265, 43.650044),
    ("Les Cadaux", 1.708109, 43.764526),
    ("63 rue de la T√©oul√®re", -0.51339, 43.86374),
    ("Rue Voltaire", 3.65434, 49.570995),
    ("Avenue des Vergers", 5.016525, 43.823463),
    ("Avenue Marcelin Berthelot - Ecopole", 4.803638, 43.627203),
    ("Chemin des sables", 6.359001, 48.603035),
    ("Boulevard de la Marquette", 1.42654, 43.612035),
    ("Avenue du Maquis de l'Oisans", 5.705928, 45.114844),
    ("Chemin de la Nasque - ZA En Jacca", 1.308156, 43.599933),
    ("57 boulevard industriel", 1.110854, 49.404147),
    ("Avenue de l'Europe - ZI Nord Est", 4.745585, 45.989633),
    ("Boulevard du Commerce", 6.696852, 43.450141),
    ("Rue de la Mare aux Joncs", 2.369223, 48.602659),
    ("Place de la Logistique", 2.36036136746406, 48.7518963504815),
    ("Plateforme logistique de Delta 3", 2.977241, 50.453691),
    ("10 rue des Allies", 6.16511495, 49.12947861),
    ("Relais Mar√©chal Leclerc", 2.324772, 48.820553),
    ("Zone de Kerabel", -2.973392, 48.532065),
    ("M6 direction Lyon", 4.766368, 45.816547),
    ("3800, Route Nationale 113", 5.2071279, 43.508036),
    ("Rue du 14 juillet", 4.164077, 48.293365),
    ("10 rue Louis Armand", 2.908609, 49.22925),
    ("Avenue de la Houille Blanche", 5.890755, 45.587655),
    ("avenue du Luxembourg", 3.549676, 47.851959),
    ("260 Route Nationale 20 - ZA Grand Sud Labastide Saint Pierre", 1.313795, 43.914623),
    ("Rue du Pr√© le Loup", 6.178643, 49.222276),
    ("684 rue du chemin Vert", 3.14036585390567, 50.5746340190336),
    ("Avenue des Chatelets", -2.7959828, 48.4676891),
    ("ZA Croix Chartier", 4.408257, 45.628359),
    ("52 rue Henry Becquerel", 2.597703, 48.892495),
    ("avenue Dr Shweitzer", 5.031118, 45.769833),
    ("ZAC Actipole", -1.91712, 48.538009),
    ("A9 Aire Palme Ouest", 2.969899, 42.950266),
    ("Relais Vertou Grassini√®re (Ouest)", -1.51318, 47.1617),
    ("14 quai Fran√ßais", -0.531422, 44.898503),
    ("Quartier Mondy", 5.038105, 45.0060573),
    ("10 rue Paul-Emile Victor, Zac Bressandi√®re", -0.256567, 46.669589),
    ("rue alfred Kastler", 2.81721, 50.29678),
    ("nan", 2.494451, 48.971117),
    ("58 avenue de l'ile Brune", 5.668913, 45.233381),
    ("Av Marcel Paul", 0.777324, 45.183638),
    ("1 rue Jean Baptiste Dumaire", 7.087186, 49.107248),
    ("Aire de Beaune les Mines - A20", 1.292548, 45.907928),
    ("Route de Mouliherne √† Clefs", 0.008722, 47.521806),
    ("195 avenue du Haut L√©v√®que", -0.64952641608, 44.780775084),
    ("rue Roberto Cabanas", -4.438492, 48.438492),
    ("ZA des Dahini√®res, Route de Foug√®res", -0.816301, 48.084214),
    ("Avenue des Vieux Moulins", 6.115909, 45.887976),
    ("avenue Robert Schumann", 3.282154, 43.339939),
    ("ZI R√©publique Nord - Centre Routier", 0.34537644, 46.61820542),
    ("Lyon Chassieu", 4.97037344, 45.72311693),
    ("Relai des coquelicots", 4.295417, 45.52398),
    ("ZAC BRIVE LAROCHE", 1.468735, 45.154084),
    ("Route de Saucats", -0.729556, 44.714002),
    ("389 rue des Hauts de France", 2.9759, 50.4585),
    ("ZAC de l'Orme des Sources", 4.30579, 45.54591),
    ("Rue Richard Trevithick", 5.367906, 43.490132),
    ("ZI ouest - rue des puits √† Marne", 2.765209, 49.703905),
    ("Boulevard du Mercantour - MIN d'Azur", 7.207106, 43.669697),
    ("Quai d'Issy les Moulineaux", 2.26627025, 48.83500085),
    ("1394 avenue de Draguignan", 6.039012, 43.14503),
    ("RD 6 - ZAC Saint Charles", 5.60638, 43.4608),
    ("ZA Riedwald - RUE DE L'EUROPE", 7.376702, 47.777932),
    ("ZI Le Poirier Pench√© - RN 19", 2.592409, 48.705436),
    ("20 rue de Villeneuve", 0.181547, 48.051984),
    ("Port de Limay-Porcheville", 1.742635, 48.983601),
    ("5 rue des M√©tiers", -1.28179, 43.666321),
    ("56 rue L√©on Trostski", 3.87111559510231, 43.5815114035832),
    ("Angle boulevard Marcel Paul et avenue des Lions", -1.61662437021732, 47.2467973532067),
    ("Parc d'activit√© le Ch√™ne", -2.229719, 48.126595),
    ("80 rue Jean Prouv√©", 6.20985, 48.6155969),
    ("La Briqueterie", -0.586049, 48.300685),
    ("Rue marie curie", 5.0862674, 45.0472622),
    ("avenue de la Courbade", 4.435835, 43.754565),
    ("ZA La Carr√®re - 49 route de la Cant√®re", -1.018368, 43.740843),
    ("Avenue d'Aquitaine", 0.638194, 44.184881),
    ("Rue des Fr√®res Lumi√®res", -0.4871, 44.914306),
    ("1 rue Eug√®ne Weiss", 4.416151, 45.448939),
    ("Rue Marcel M√©rieux", 4.921162, 45.670149),
    ("120 Rue Marcel Paul", 2.52932712435722, 48.8127812363799),
    ("ZAC du haut de Wissous II, Chemin de la Croix Bris√©e", 2.309302, 48.722674),
    ("Rue Gustave Eiffel", 3.300625, 49.819455),
    ("Avenue du Meyrol", 4.7428, 44.5768),
    ("Parc des Marais", 0.207057, 49.485884),
    ("rue du Champ du Verger", 0.156359, 47.945486),
    ("Avenue Hector Berlioz", 3.131918, 45.909493),
    ("Rue de la Croix Saint-Jacques", 3.027935, 48.381617),
    ("Rue du Tertre de Cherisy", 2.687905, 48.540101),
    ("Rue Barthelemy Thimonier", 2.566366, 44.32378),
    ("Chemin des M√©sanges", 1.400312, 43.543716),
]

def get_osrm_route(waypoints):
    waypoint_str = ";".join(["{},{}".format(lon, lat) for lat, lon in waypoints])
    url = f"{OSRM_SERVER}/route/v1/driving/{waypoint_str}?overview=full&geometries=geojson"
    response = requests.get(url)
    if response.status_code != 200:
        return []
    data = response.json()
    if 'routes' not in data or not data['routes']:
        return []
    return data['routes'][0]['geometry']['coordinates']

def is_within_corridor(start, end, point, corridor_km=100):
    d1 = geodesic((start[0], start[1]), (point[1], point[2])).km
    d2 = geodesic((point[1], point[2]), (end[0], end[1])).km
    d_total = geodesic((start[0], start[1]), (end[0], end[1])).km
    return abs((d1 + d2) - d_total) <= corridor_km

def build_route_with_filtered_tankstations(start, end, tankstations, interval_km=250, corridor_km=100):
    route = get_osrm_route([start, end])
    if not route:
        return [], []
    filtered_tanks = [ts for ts in tankstations if is_within_corridor(start, end, ts)]
    waypoints = [start]
    used_stations = []
    total_distance = 0
    last_point = route[0]
    for i in range(1, len(route)):
        curr_point = route[i]
        step_distance = geodesic((last_point[1], last_point[0]), (curr_point[1], curr_point[0])).km
        total_distance += step_distance
        if total_distance >= interval_km:
            if filtered_tanks:
                closest = min(filtered_tanks, key=lambda s: geodesic((curr_point[1], curr_point[0]), (s[1], s[2])).km)
                if closest not in used_stations:
                    used_stations.append(closest)
                    waypoints.append((closest[1], closest[2]))
                else:
                    used_stations.append(("Geen OG tanklocatie mogelijk", curr_point[1], curr_point[0]))
                    waypoints.append((curr_point[1], curr_point[0]))
            else:
                used_stations.append(("Geen OG tanklocatie mogelijk", curr_point[1], curr_point[0]))
                waypoints.append((curr_point[1], curr_point[0]))
            total_distance = 0
        last_point = curr_point
    waypoints.append(end)
    return waypoints, used_stations

def geocode_address(address):
    geolocator = Nominatim(user_agent="streamlit-routeplanner")
    location = geolocator.geocode(address)
    if location:
        return (location.latitude, location.longitude)
    return None

# Streamlit UI


col1, col2 = st.columns([1, 8])
with col1:
    st.image("Alleen spark.png", width=50)
with col2:
    st.title("OG routekaart")

start_address = st.text_input("Startadres", value="")
end_address = st.text_input("Eindadres", value="")
route_name = st.text_input("Routenaam", value="Mijn Route")

interval_km = st.slider("Afstand tussen tankstops (km)", min_value=100, max_value=500, value=250, step=25)
corridor_km = st.slider("Maximale omweg vanaf hoofdlijn (km)", min_value=25, max_value=300, value=100, step=25)

if st.button("Genereer Route"):
    start = geocode_address(start_address)
    end = geocode_address(end_address)

    if not start or not end:
        st.error("Kon √©√©n van de adressen niet vinden.")
    else:
        waypoints, used_stations = build_route_with_filtered_tankstations(start, end, tankstations, interval_km=interval_km, corridor_km=corridor_km)
        route_coords = get_osrm_route([(wp[0], wp[1]) for wp in waypoints])
        if route_coords:
            df = pd.DataFrame(route_coords, columns=["Longitude", "Latitude"])
            df["Route"] = route_name
            st.map(df.rename(columns={"Latitude": "lat", "Longitude": "lon"}))

            st.subheader("üìç OG Tanklocaties op de route")
            tank_df = pd.DataFrame([
                {"Latitude": lat, "Longitude": lon, "Naam": name}
                for name, lat, lon in used_stations
            ])
            st.map(tank_df.rename(columns={"Latitude": "lat", "Longitude": "lon"}))

            tank_df = tank_df.dropna(subset=["Latitude", "Longitude"])
            
            # Bereken totale routeafstand met tankstops
            totale_afstand = 0
            for i in range(1, len(route_coords)):
                p1 = route_coords[i - 1]
                p2 = route_coords[i]
                totale_afstand += geodesic((p1[1], p1[0]), (p2[1], p2[0])).km

            # Bereken afstand zonder tussenliggende tankstops
            originele_coords = get_osrm_route([start, end])
            originele_afstand = 0
            for i in range(1, len(originele_coords)):
                p1 = originele_coords[i - 1]
                p2 = originele_coords[i]
                originele_afstand += geodesic((p1[1], p1[0]), (p2[1], p2[0])).km

            st.write("üõ£Ô∏è **Totale afstand met OG-tanklocaties:** {:.1f} km".format(totale_afstand))
            st.write("üìè **Afstand zonder tankstops:** {:.1f} km".format(originele_afstand))


            for i, (name, _, _) in enumerate(used_stations, 1):
                st.markdown("üõ¢Ô∏è **Tankmoment {}:** {}".format(i, name))
        else:
            st.error("Kon geen route genereren met OSRM.")
